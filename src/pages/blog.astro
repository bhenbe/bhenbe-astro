---
import BaseLayout from '../layouts/BaseLayout.astro'

const months = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre']
const data = await fetch(
    'https://graphql.datocms.com/',
    {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
            'Authorization': `Bearer 474e113b8e779f09724e19ed0ef15b`,
        },
        body: JSON.stringify({
            query: `{
                allPosts(locale: fr, orderBy: postDate_DESC) {
                    titre
                    slug
                    postDate
                    id
                }
            }`
        }),
    }
).then((response) => response.json());
---
<BaseLayout title="Le blog">

    <main id="main">

        <h1>Le blog</h1>

        <nav class="blog-summary">
            <ul>
            {data.data.allPosts.map((post, index) => {
                return (
                    <li key={index}>
                        <a href={"/blog/" + post.slug}>
                            {post.titre}
                            <span>{months[(parseInt(post.postDate.slice(5, 7)) - 1)]} {' '} {post.postDate.slice(0, 4)}</span>
                        </a>
                    </li>
                )
            })}
            </ul>
        </nav>

    </main>

</BaseLayout>